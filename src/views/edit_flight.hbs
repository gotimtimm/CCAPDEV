<h3>{{pageTitle}}</h3>

<div class="card shadow-sm">
  <div class="card-body">
    <form action="/admin/flights/update/{{flight._id}}" method="POST">
      
      <div class="mb-3">
        <label for="flightNumber" class="form-label">Flight Number</label>
        <input type="text" class="form-control" id="flightNumber" name="flightNumber" value="{{flight.flightNumber}}" required>
      </div>
      
      <div class="mb-3">
        <label for="airlineName" class="form-label">Airline Name</label>
        <input type="text" class="form-control" id="airlineName" name="airlineName" value="{{flight.airlineName}}" required>
      </div>

      <div class="row">
        <div class="col-md-6 mb-3">
          <label for="origin" class="form-label">Origin</label>
          <select class="form-control" id="origin" name="origin" required>
            {{#each locations}}
              <option value="{{this}}" {{#if (eq this ../flight.origin)}}selected{{/if}}>{{this}}</option>
            {{/each}}
          </select>
        </div>
        <div class="col-md-6 mb-3">
          <label for="destination" class="form-label">Destination</label>
          <select class="form-control" id="destination" name="destination" required>
            {{#each locations}}
              <option value="{{this}}" {{#if (eq this ../flight.destination)}}selected{{/if}}>{{this}}</option>
            {{/each}}
          </select>
        </div>
      </div>

      <div class="mb-3">
        <label for="basePrice" class="form-label">Price (PHP)</label>
        <input type="number" class="form-control" id="basePrice" name="basePrice" value="{{flight.basePrice}}" min="0" required>
      </div>

      <div class="row">
        <div class="col-md-6 mb-3">
          <label for="departureDate" class="form-label">Departure Date</label>
          <input type="date" class="form-control" id="departureDate" name="departureDate" value="{{flight.departureDate}}" required>
        </div>
        <div class="col-md-6 mb-3">
          <label for="arrivalDate" class="form-label">Arrival Date</label>
          <input type="date" class="form-control" id="arrivalDate" name="arrivalDate" value="{{flight.arrivalDate}}" required>
        </div>
      </div>

      <div class="row">
        <div class="col-md-6 mb-3">
          <label for="departureTime" class="form-label">Departure Time</label>
          <input type="time" class="form-control" id="departureTime" name="departureTime" value="{{flight.departureTime}}" required>
        </div>
        <div class="col-md-6 mb-3">
          <label for="arrivalTime" class="form-label">Arrival Time</label>
          <input type="time" class="form-control" id="arrivalTime" name="arrivalTime" value="{{flight.arrivalTime}}" required>
        </div>
      </div>

      <div class="row">
        <div class="col-md-8 mb-3">
          <label for="aircraftType" class="form-label">Aircraft Type</label>
          <select class="form-select" id="aircraftType" name="aircraftType" required>
            <option value="" disabled>Select Aircraft</option>
            <option value="Airbus A320">Airbus A320</option>
            <option value="Boeing 737">Boeing 737</option>
            <option value="Boeing 777">Boeing 777</option>
            <option value="Airbus A350">Airbus A350</option>
            <option value="Cessna 172">Cessna 172</option>
          </select>
        </div>
        <div class="col-md-4 mb-3">
          <label for="seatCapacity" class="form-label">Seat Capacity</label>
          <input type="number" class="form-control" id="seatCapacity" name="seatCapacity" value="{{flight.seatCapacity}}" required readonly>
        </div>
      </div>
      
      <hr>
      
      <button type="submit" class="btn btn-success">Update Flight</button>
      <a href="/admin/flights" class="btn btn-secondary">Cancel</a>
      
    </form>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const aircraftMap = {
        "Airbus A320": 180,
        "Boeing 737": 160,
        "Boeing 777": 396,
        "Airbus A350": 350,
        "Cessna 172": 4
    };

    const typeSelect = document.getElementById('aircraftType');
    const capacityInput = document.getElementById('seatCapacity');
    
    const currentType = "{{flight.aircraftType}}";
    if (currentType && (Object.keys(aircraftMap).includes(currentType) || currentType !== "")) {
        typeSelect.value = currentType;
        
        if(aircraftMap[currentType]) {
            capacityInput.value = aircraftMap[currentType];
        }
    }

    typeSelect.addEventListener('change', function() {
        const selected = this.value;
        if(aircraftMap[selected]) {
            capacityInput.value = aircraftMap[selected];
        }
    });
  });
</script>