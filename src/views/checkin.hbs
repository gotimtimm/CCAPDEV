<!DOCTYPE html>
<html>
<head>
  <title>Online Check-in</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background-color: #f8f9fa; }
    .checkin-card { max-width: 500px; margin: 50px auto; border-radius: 15px; }
    .boarding-pass { border: 2px dashed #0d6efd; background: #e7f1ff; display: none; }
  </style>
</head>
<body>

  <nav class="navbar navbar-dark bg-primary mb-4">
    <div class="container">
      <a class="navbar-brand" href="/">✈️ La Salle Airlines</a>
    </div>
  </nav>

  <div class="container">
    <div class="card shadow checkin-card">
      <div class="card-body p-4">
        <h3 class="text-center mb-4">Online Check-in</h3>
        
        <form id="checkinForm">
          <div class="mb-3">
            <label class="form-label">Booking Reference (PNR)</label>
            <input type="text" class="form-control form-control-lg text-uppercase" id="pnrInput" placeholder="e.g. A1B2C3" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Last Name</label>
            <input type="text" class="form-control form-control-lg" id="lastNameInput" placeholder="e.g. Dela Cruz" required>
          </div>
          <button type="submit" class="btn btn-primary w-100 btn-lg">Check In Now</button>
        </form>

        <div id="errorAlert" class="alert alert-danger mt-3 d-none"></div>

        <div id="successDisplay" class="mt-4 boarding-pass p-3 rounded">
            <h4 class="text-success text-center">Check-in Complete! ✅</h4>
            <hr>
            <p><strong>Passenger:</strong> <span id="bpName"></span></p>
            <p><strong>Flight:</strong> <span id="bpFlight"></span></p>
            <p><strong>Seat:</strong> <span id="bpSeat" class="fs-4 fw-bold"></span></p>
            <p class="text-center text-muted"><small>Boarding Pass #: <span id="bpNumber"></span></small></p>
        </div>

      </div>
    </div>
  </div>

  <script>
    document.getElementById('checkinForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const pnr = document.getElementById('pnrInput').value;
      const lastName = document.getElementById('lastNameInput').value;
      const errorAlert = document.getElementById('errorAlert');
      const successDisplay = document.getElementById('successDisplay');

      // Reset UI
      errorAlert.classList.add('d-none');
      successDisplay.style.display = 'none';

      try {
        // Call the API
        const response = await fetch('/api/checkin', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ pnr, lastName })
        });

        const result = await response.json();

        if (result.success) {
          // Show Boarding Pass
          document.getElementById('bpName').textContent = result.data.passenger;
          document.getElementById('bpFlight').textContent = result.data.flight;
          document.getElementById('bpSeat').textContent = result.data.seat;
          document.getElementById('bpNumber').textContent = result.data.boardingPass;
          successDisplay.style.display = 'block';
          // Hide Form
          document.getElementById('checkinForm').style.display = 'none';
        } else {
          // Show Error
          errorAlert.textContent = result.message;
          errorAlert.classList.remove('d-none');
        }
      } catch (err) {
        errorAlert.textContent = "Connection error. Please try again.";
        errorAlert.classList.remove('d-none');
      }
    });
  </script>
</body>
</html>

